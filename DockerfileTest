# Указываем базовый образ для Node.js
FROM node AS build

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем файлы package.json и package-lock.json
COPY package*.json ./

# Устанавливаем зависимости для серверной части
RUN npm install

# Копируем серверную часть
COPY . .

# Переходим в директорию клиента
WORKDIR /app/CLIENT

# Устанавливаем зависимости для клиентской части
RUN npm install

# Собираем клиентскую часть
RUN npm run build

# Возвращаемся в корневую директорию
WORKDIR /app

# Команда по умолчанию для запуска сервера и клиента
CMD ["npm", "run", "dev"]

# Этот Dockerfile сначала устанавливает зависимости для серверной части,
# копирует все файлы проекта, затем переходит в директорию клиента, 
# устанавливает зависимости для клиентской части и выполняет сборку. 
# После этого команда по умолчанию запускает сервер и клиент в режиме разработки,
# как указано в скриптах вашего package.json.
